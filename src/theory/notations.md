# Системы счисления (-)

## Цифровые и аналоговые значения

Микроконтроллеры являются **цифровыми** устройствами, это означает, что информация в них хранится и обрабатывается в цифровом, то есть дискретном виде. Дискретность подразумевает что существует минимальный шаг, разделяющий два соседних значения. Например для микроконтроллеров таким минимальным шагом является 1 бит, мы не можем хранить и обрабатывать в микроконтроллере информацию не кратную 1 биту. При этом правильный способ представления битов позволяет нам представлять в цифровом виде дробные числа, например 0.5 (немного подробнее об этом будет ниже).

Кроме цифровых существую **аналоговые** устройства, представляющие данные в аналоговом - непрерывном виде. Непрерывность означает что не существует минимального шага, на который могут отличаться два числа, то есть шаг может уменьшаться до бесконечно малого, но не равного 0. Примерами непрерывных величин являются многие физические параметры: напряжение, ток, температура, давление и многие другие.

## Понятие систем счисления

Самой привычной для человека системой счисления является десятичная, от части это объясняется количеством пальцев на руке человека, благодаря чему гораздо проще учить считать маленьких детей. Данная система использует 10 цифр: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9. Из этих цифр в десятичной системе счисления можно построить любое, сколь угодно большое или маленькое число. Количество цифр в системе счисления называется **основанием системы счисления**. Соответственно десятичная система названа именно так, из-за того, что имеет основание 10. В теории можно построить систему счисления с любым основанием, так как результаты любых математических операций никак не зависят от используемой системы счисления, но на практике далеко не все системы являются целесообразными и полезными.

Рассмотрим несколько важных понятий применимых к любой системе счисления на примере десятичного числа \\(8357 \\). Это число можно представить как \\( 8 \cdot 1000 + 3 \cdot 100 + 5 \cdot 10 + 7 \cdot 1 \\) или \\( 8 \cdot 10^{3} + 3 \cdot 10^{2} + 5 \cdot 10^{1} + 7 \cdot 10^{0} \\). Позицию цифры в числе справа налево будем называть **разрядом**, например число \\( 8357 \\) имеет 5 во втором разряде и 8 в четвертом. числа 1, 10, 100, 1000 - **"веса"** соответственно 1, 2, 3 и 4 разрядов. Можно заметить, что каждый следующий разряд имеет "вес", который в *основание системы счисления* раз больше предыдущего. 

**N-разрядным десятичным числом** называется число, которое может принимать одно из \\( 10^{N} \\) значений в интервале от \\( 0 \\) до \\( (10^{N}-1) \\), данный интервал называется **диапазоном N-разрядного десятичного числа**. Например, 4-разрядное десятичное число может принимать одно из 10000 значений от 0 до 9999. 

 **Важно понимать.** ```Если речь идет о N-разрядном числе, то в его записи всегда должны присутствовать именно N разрядов, то есть N чисел. Например, если рассматривать 24, как 2-разрядное десятичное число, то его запись не изменится. Если же рассматривать 24, как 3-разрядное или 4-разрядное десятичное число, то корректной записью будет 024 и 0024 соответственно. Понятие N-разрядного числа редко применяется к десятичным числам, но очень часто встречается при работе с двоичными и шестнадцатеричными.```

Любое N-разрядное число в любой системе счисления можно представить в следующе виде:

\\[ \begin{equation} число = \sum_{k=1}^{N}(число\\, в\\, разряде\\, k)\cdot(основание\\, системы\\, счисления)^{k-1} \end{equation} \\]

При этом если *основание системы счисления* и *число в k-ом разряде* в данной формуле представить в десятичном виде, данная формула становится универсальной для перевода числа из любой системы счисления в десятичную. Примеры по переводу из других систем счисления будут показаны в соответствующих главах. 

**Важно понимать.** ```В теории, если представить значения основания системы счисления и числа в k-ом разряде в формуле выше в любой другой системе счисления, то эта формула сможет стать универсальной для перевода из имеющейся системы счисления в любую другую, но чтобы это работало на практике, нужно чувствовать себя комфортно в умножении чисел вне десятичной системы счисления, что является очень сложной когнитивной задачей. На практике данная формула используется только для перевода в десятичную из других систем счисления. Для перевода же между системами счисления отличными от десятичной обычно используется промежуточный перевод в десятичную. Конкретные способы перевода между системами счисления будут даны в соответствующих главах.```

Для удобства понимания, в какой именно системе счисления представлено то или иное число, справа от числа может проставляться его основание, например: **8357**\\(\_{10} \\) - десятичное число, **1001**\\(\_{2} \\) - двоичное число, **8CA7**\\(\_{16} \\) - шестнадцатеричное число. Данная запись удобна для теоретических материалов, например книг, но совершенно не пригодна для программирования, так как формулы такого вида получаются специальными инструментами форматирования текста. Вместо этого в программировании используются специальные префиксы: **"0b"** - двоичное число, **"0o"** - восьмеричное число (данная система счисления не актуальна в современном мире, но в ней в том числе иногда представляются данные для отладки), **"0x"** - шестнадцатеричное число. При этом **если префикса не**т, подразумевается, что **число записано в десятичном виде**. Несколько примеров: **8357** - десятичное число, **0b1001** - двоичное число, **0x8CA7** - шестнадцатеричное число. Данное методическое пособие направленно на обучение студентам программирования микроконтроллеров, поэтому мы будем пользоваться преимущественно вторым видом записи.

## Двоичная система счисления

Все современные цифровые устройства построены на транзисторах - электронных устройствах, которые могут быть в двух устойчивых состояниях: открытом и закрытом. Вообще говоря транзисторы могут находиться и в "частично открытом" состоянии, но в цифровых устройствах это свойство не используется. Соответственно для описания работы транзистора необходимо всего 2 цифры: 0 - сигнала нет, 1 - сигнал есть, основанием такой системы является 2, а сама система называется **двоичной**. Одиночный разряд в двоичной системе называется битом, а последовательность бит, объединенных в одно число - **двоичным числом**. В соответствии с определениями выше, N-разрядное(битное) двоичное число, может представлять из себя одно из \\( 2^{N} \\) значений в интервале от \\(0 \\) до \\( 2^{N} - 1\\). Например 10-разрядное двоичное число может принимать одно из 1024 значений в интервале от 0 до 1023. Как не удивительно это может показаться, но все современные цифровые устройства строятся именно на транзисторах и их свойстве быть в одном из двух устойчивых состояний. 

Для экономии времени при работе с двоичной системой стоит запомнить веса 16 первых разрядов: 1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768. Это можно очень сильно сэкономить время для базовых расчетов и переводов между системами счисления, которые при программировании микроконтроллеров совершаются довольно часто. Кроме этого одним, возможно очевидным, но важным, моментом для понимания является факт того, что десятичное значение N-битного числа, в котором все биты равняются 1, будет равно сумме всех весов включая вес N-ого разряда и даст число равное \\(2^{N}-1\\). Например сумма всех весов до 6-ого разряда включительно даст **1 + 2 + 4 + 8 + 16 + 32 = 63**, до 10-ого **1 + 2 + 4 + 8 + 16 + 32 + 64 + 128 + 256 + 512 = 1023**, а до 16-ого такая сумма будет равна **65535**.

### Перевод между двоичной и десятичной системой счисления.

Для **перевода из двоичной системы счисления в десятичную** стоит воспользоваться универсальной формулой приведенной выше. То есть необходимо просуммировать произведения всех разрядов числа с их весами. Рассмотрим два примера:

**Найти десятичное представление числа 101101**\\( \_{2}\\):

 \\[ 101101_{2} = 1\cdot2^{5} + 0\cdot2^{4} + 1\cdot2^{3} + 1\cdot2^{2} + 0\cdot2^{1} + 1\cdot2^{0} = 32 + 8 + 4 + 1 = 45_{10} \\]

**Найти десятичное представление числа 11000110101**\\(_{2}\\):

\\[ 11000110101_{2} = 1\cdot2^{10} + 1\cdot2^{9} + 0\cdot2^{8} + 0\cdot2^{7} + 0\cdot2^{6} + 1\cdot2^{5} + 1\cdot2^{4} + 0\cdot2^{3} + \\\\  + 1\cdot2^{2} + 0\cdot2^{1} + 1\cdot2^{0} = 1024 + 512 + 32 + 16 + 4 + 1 = 1589_{10} \\]

Для **перевода из десятичной системы в двоичную** можно использовать 2 подхода: **Слева-направо**: Найти наибольший вес в двоичной системе счисления меньший заданного десятичного числа, это определит количество бит в итоговом двоичном числе. После этого стоит записать первую *единицу* двоичного числа и отнять от десятичного подобранный вес. Дальше необходимо проверять является ли каждый следующий по убыванию вес меньше, чем оставшееся десятичное число. Если вес меньше, его стоит отнять от остатка десятичного числа, а в двоичное число записать 1, если же вес разряда больше, чем остаток десятичного числа, то нужно записать в двоичное число 0 без вычитания веса от остатка десятичного числа. Таким образом надо проверить все веса вплоть до 1. Рассмотрим на двух примерах:

**Перевести в десятичную систему число 91**\\(\_{10}\\):

Для 91 наибольшим весом в двоичной системе счисления является 64, значит двоичное число будет состоять из 7 цифр. Запишем первую цифру 1 двоичного числа (далее в примере после каждой итерации в скобочках будет записано число, где единицами и нулями будут записаны уже известные разряды, а точками еще неизвестные, для данного случая 1......). 91-64 = 27. Следующий после 64 разряд - 32 > 27, то есть запишем 0 и пойдем дальше (10.....), следующий разряд 16, 27-16 = 11 (101....), после 16 идет 8, 11-8 = 3 (1011...), далее 4, но 4 больше 3, поэтому снова запишем 0 (10110..), после чего идут 2 и 1, соответственно 3-2 = 1**, 1-1 = 0, итоговое число **1011011**\\(\_{2}\\).

**Перевести в десятичную систему число 210**\\(\_{10}\\):
Наибольший двоичный вес меньше 210 - 128 (в двоичном числе будет 8 цифр). Рассмотрим этот пример без лишних объяснений 210-128 = 82 (1.......); 82-64 = 18 (11......); 32 > 18 (110.....); 18-16 = 2 (1101....); 8 > 2 (11010...); 4 > 2 (110100..); 2-2 = 0 (1101001.); 1 > 0 (**11010010**).

**Справа налево**: Десятичное число необходимо целочисленно делить на 2 до момента, пока число не станет равным 0. Остаток от деления на 2 на каждом этапе будет добавляться в следующий разряд двоичного числа. Рассмотрим на тех же примерах:

**Перевести в двоичную систему число 91**\\(\_{10}\\):

При делении 91 на 2 получим 45 и 1 в остатке, запишем единицу из остатка как первый разряд двоичного числа (1). 45 / 2 = 22 и 1 в остатке (11); 22/2 = 11, 0 (011); 11/2 = 5, 1 (1011); 5/2 = 2, 1 (11011); 2/2 = 1, 0 (011011); 1/2 = 0, 1 (**10110011**).

**Перевести в двоичную систему число 210**\\(\_{10}\\):

210/2 = 105, 0 (0); 105/2 = 52, 1 (10); 52/2 = 26, 0 (010); 26/2 = 13, 0 (0010); 13/2 = 6, 1 (10010); 6/2 = 3, 0 (010010); 3/2 = 1, 1 (1010010); 1/2 = 0, 1 (**11010010**).

## Шестнадцатеричная система счисления

Микроконтроллеры STM32 являются 32-разрядными. Под **разрядностью цифрового устройства** подразумевают количество разрядов (битов), обрабатываемых в один момент времени внутри устройства. Например 32-разрядные устройства работают с 32-разрядными двоичными числами, 64-разрядные с 64-разрядными и так далее. Для обработки чисел большйе разрядности приходится проводить операции в несколько этапов, например для суммирования 64-разрядного числа с использованием 32-разрядного устройства необходимо сначала просуммировать первые 32 бита двух чисел, а потом с учетом переполнения первой суммы (если сумма больше максимального 32-разрядного числа, к следующей сумме необходимо прибавить 1, так как это единица "не помещается" в первых 32 битах итоговой суммы) 32-следующих бита. Информация о тонкостях работы с двоичными числами будет описываться в материале по мере необходимости.

Учитывая, что для записи 32-разрядного двоичного числа необходимо записать минимум 32 цифры плюс префикс, работа с такими числами на бумаге и в исходном коде может становиться очень времязатратной. Для упрощения записи больших двоичных чисел их удобно разбивать на группы по 4 бита из которых каждая представляет одну из \\(2^{4} = 16) комбинаций, то есть использовать систему счисления с основанием 16 (шестнадцатеричную). Для записи шестнадцатеричных чисел используют 10 арабских цифр для 10 первых цифр: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 - и буквы A-F для записи оставшихся 6: A(10), B(11), C(12), D(13), E(14), F(15). В таблице ниже приведено соответствие первых 16 чисел в двоичной, десятичной и шестнадцатеричной системах счисления.

| Двоичная | Шестнадцатеричная | Десятичная |
|:--------:|:-----------------:|:----------:|
|   0000   |         0         |      0     |
|   0001   |         1         |      1     |
|   0010   |         2         |      2     |
|   0011   |         3         |      3     |
|   0100   |         4         |      4     |
|   0101   |         5         |      5     |
|   0110   |         6         |      6     |
|   0111   |         7         |      7     |
|   1000   |         8         |      8     |
|   1001   |         9         |      9     |
|   1010   |         A         |     10     |
|   1011   |         B         |     11     |
|   1100   |         C         |     12     |
|   1101   |         D         |     13     |
|   1110   |         E         |     14     |
|   1111   |         F         |     15     |
|   10000  |         10        |     16     |

Данную таблицу рекомендуется распечатать и в начале изучения программирования микроконтроллеров всегда держать под рукой, так как переводы между шестнадцатеричными и двоичными числами будут происходить постоянно. Использование шестнадцатеричной системы счисления позволяет сократить запись двоичных чисел в 4 раза. Например для записи 32-разрядного двоичного числа требуется всего 8-разрядное шестнадцатеричное число.

### Перевод между десятичной и шестнадцатеричной системами счисления

Для **перевода из шестнадцатеричной системы счисления в десятичную** стоит воспользоваться универсальной формулой перевода в десятичную систему, описанную выше. То есть необходимо просуммировать произведения всех разрядов числа с их весами. Рассмотрим два примера:

**Перевести в десятичную систему счисления число 34**\\( \_{16}\\):

 \\[ 34_{2} = 3\cdot16^{1} + 4\cdot16^{0} = 48 + 4 = 52_{10} \\]

**Перевести в десятичную систему счисления число 1ABC**\\(_{16}\\):

\\[ 1ABC_{16} = 1\cdot16^{3} + 10\cdot16^{2} + 11\cdot16^{1} + 12\cdot16^{0} = 4096 + 2560 + 176 + 12 = 6844_{10} \\]

Для **перевода из десятичной системы счисления в шестнадцатеричную** можно как и в случае с двоичной системой пойти слева на права и справа на лева. Методология перевода **слева направо** остается неизменной, только в этот раз необходимо делить на 16, вместо 2, то есть на *основание системы счисления*. При переводе же **справа налево** необходимо снова найти максимальный вес меньше исходного числа. После этого необходимо разделить исходное число на данный вес, целая часть от деления записывается в вычисляемый разряд, а остаток от деления продолжает проверяться. Данные алгоритмы являются универсальными для перевода из десятичной системы счисления в любую другую. Рассмотрим два примера:

**Перевести в шестнадцатеричную систему счисления число 108**\\(\_{10}\\):

**Слева направо**: Максимальный вес меньше 108 это 16. 108/16 = 6, 12 в остатке (6.). следующий вес за 16 - 1. 12/1 = 12 = 0xC, то есть итоговое число 6C\\(\_{16}\\).

**Справа налево**: 108/16 = 6, 12(C) в остатке (С). 6/16 = 0, 6 в остатке. Итоговое число **6С**.

**Перевести в шестнадцатеричную систему счисления число 782**\\(\_{10}\\):

**Слева направо**: Максимальный вес меньше 782 - 256; 782/256 = 3, 14 (3..), 14 < 16 (30.), 14/1 = 14 = 0xE (**30E**).

**Справа налево**: 782/16 = 48, 14 (E), 48/16 = 3, 0 (0E), 3/16 = 0, 3 (**30E**).

### Перевод между двоичной и шестнадцатеричной системами счисления

Учитывая, что в каждый шестнадцатеричный разряд входит ровно 4 двоичных, для **перевода из шестнадцатеричной системы счисления в двоичную** необходимо вместо каждого шестнадцатеричного числа поставить соответствующее 4-битное двоичное в соответствии с таблицей выше. Пара примеров:

**Перевести в двоичную систему счисления число C1E**\\(\_{16}\\):

0xC = 0b1100, 0x1 = 0b0001, 0xE = 0b1110. 0xC1E = **0b110000011110**.

**Перевести в двоичную систему счисления число 4AAB83**\\(\_{16}\\):
0x4 = 0b0100, 0xA = 0b1010, 0xA = 0b1010, 0xB = 0b1011, 0x8 = 0b1000, 0x3 = 0b0011. 0x4AAB83 = **0b010010101010101110000011**. Как можно заметить по этому примеру, запись 24-битного двоичного числа уже очень плохо читабельна и поэтому совершенно неудобна.

Для **перевода из двоичной системы счисления в шестнадцатеричную** необходимо начиная с первого разряда разбить двоичное число на группы по 4 бита, после чего каждую группу по таблице можно заменить шестнадцатеричным числом. При таком переводе удобно переводить каждую группу сначала в десятичную систему счисления, а потом подставлять соответствующее шестнадцатеричное число. Если после разбиения в последней группе получилось меньше 4 бит, в начало числа можно дописать необходимое количество нолей. Для перевода в десятичную полезно помнить, что веса первых четырех двоичных разрядов: 1, 2, 4, 8, после чего можно просто находить десятеричный эквивалент. Рассмотрим на двух примерах:

**Перевести в шестнадцатеричную систему счисления 10100111**\\(\_{2}\\):

10100111 = 1010 0111. 0b1010 = 10 = A, 0x0111 = 7 = 0x7. Тогда 0b10100111 = **0xA7**.

**Перевести в шестнадцатеричную систему счисления 11011010011101**\\(\_{2}\\):

11011010011101 = 11 0110 1001 1101. 0b11 = 0b0011 = 3 = 0x3, 0b0110 = 6 = 0x6, 0b1001 = 9 = 0x9, 0x1101 = 13 = 0xD. 0b11011010011101 = **0x369D**.

## Еще немного понятий, связанных с двоичными числами

Группа из восьми битов называется **байт (byte)**. Байт представляет \\( 2^{8} = 256 \\) цифровых комбинаций. Размер модулей, сохраненных в памяти современных цифровых устройств, обычно измеряется именно в байтах, а не битах. То, что в байте именное 8 бит не имеет за собой какого-то глубокого сокровенного смысла (это не всегда было так), просто в современном мире это удобно. Группа из четырех битов (половина байта) называется **полубайт (nibble)**. Полубайт представляет \\( 2^{4} = 16 \\) цифровых комбинаций. Одна шестнадцатеричная цифра занимает один полубайт, а две шестнадцатеричные цифры – один байт. В настоящее время полубайты уже не находят широкого применения, однако этот термин все же стоит знать.

Как уже говорилось ранее, микроконтроллеры обрабатывают данные группами, размер которых определяется разрядностью микроконтроллера, например 32-разрядные микроконтроллеры обрабатывают данные группами по 32 бита. Такие группы называются **словами (word)**. Соответственно размер слова зависит от разрядности микроконтроллерам или микропроцессора, с которым ведется работа.

В рамках одной группы битов конечный бит, находящийся на одном конце этой группы (обычно правом), называется наименее значимым битом (least significant bit, lsb), или просто младшим битом, а бит н а другом конце группы называется наиболее значимым битом (most significant bit, msb), или старшим битом. Рисунок ниже взят из книги "Цифровая схемотехника и архитектура компьютера", как и данное описание. Часть (a) рисунка демонстрирует наименее и наиболее значимые биты в случае 6-битного двоичного числа. Аналогичным образом, внутри одного слова можно выделить наименее значимый байт (least significant byte, LSB), или младший байт, и наиболее значимый байт (most significant byte, MSB), или старший байт. Часть (b) рисунка показывает, как это делается в случае 4-байтного числа (32 бита), записанного восемью шестнадцатеричными цифрами.

<p align="center">
  <img width="360" src="https://trimple.github.io/stm32-stand-manual/theory/images/LSB_MSB.jpg">
</p>

----



## Формы представления чисел в двоичной системе


## Математические операции над числами в двоичной системе

## Шестнадцатеричная система счисления


## Переводы между системами счисления




 
, и правой отличается больше чем При этом, если мы записываем число больше 9, то "вес" левой цифры считается в 10 раз больше, веса правой цифры. Система счисления, в которую входит 10 цифр называется десятичной или системой по основанию 10. "вес" каждой следующей цифры числа (справа на лево) увеличивается в "вес" раз.



## Задачи

1. Перевести число из данной системы в две недостающие: шестнадцатеричную, десятичную, двоичную.
   1. 11\\( \_{10} \\)
   2. 127\\( \_{10} \\);
   3. 451\\( \_{10} \\);
   4. 11\\( \_{2} \\);
   5. 10 1011\\( \_{2} \\);
   6. 1101 1110\\( \_{2} \\);
   7. 11\\( \_{16} \\);
   8. A1\\( \_{16} \\);
   9. 1FE\\( \_{16} \\);

2.  Перевести число между шестнадцатеричной и двоичной системами счисления
    1.  0b001001011101;
    2.  0b110101011011;
    3.  0b11101010101011101101;
    4.  0b11110101100001010101011101101;
    5.  0x0A34;
    6.  0x12BF;
    7.  0x076A25;
    8.  0x9492BA2C;

Для дополнительной практики в переводе между системами счисления можно самостоятельно придумывать себе числа в любой из трех основных систем счисления и переводить числа в любую другую. Проверять полученные результаты можно с использованием встроенного в **Windows calculator** окна "Программист".

3. 



### Ответы к задачам

**1.1** - B\\( \_{16} \\), 1011\\( \_{2} \\); **1.2** -  7F\\( \_{16} \\),  0111 1111\\( \_{2} \\); **1.3** - 1C3\\( \_{16} \\), 1 1100 0011\\( \_{2} \\); **1.4** - 3\\( \_{16} \\), 3\\( \_{10} \\); **1.5** - 2B\\( \_{16} \\), 43\\( \_{10} \\); **1.6** - DE\\( \_{16} \\), 222\\( \_{10} \\); **1.7** - 17\\( \_{10} \\), 1 0001\\( \_{2} \\); **1.8** - 161\\( \_{10} \\), 1010 0001\\( \_{2} \\); **1.9** - 510\\( \_{10} \\),  1 1111 1110\\( \_{2} \\).

**2.1** - 0x026D; **2.2** - 0x0D5B; **2.3** - 0x0EAAED;  **2.4** - 0x1EB0AAED; **2.5** - 0b101000110100; **2.6** - 0b1001010111111; **2.7** - 0b1110110101000100101; **2.8** - 0b10010100100100101011101000101100.

**3.1** -

